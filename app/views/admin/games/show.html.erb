<p id="notice"><%= notice %></p>

<p>
  <strong>名前:</strong>
  <%= @game.name %>
</p>

<p>
  <strong>開始時刻:</strong>
  <%= @game.start_time %>
</p>

<%= form_tag(create_number_admin_game_path(@game), method: 'post') do %>
  <%= submit_tag '抽選する' %>
<% end %>

<p>
  <div>抽選履歴</div>
  <div><%= @game.numbers.join(', ') %></div>
</p>

<table>
  <thead>
    <tr>
      <th>ターン</th>
      <th>当選者</th>
    </tr>
  </thead>

  <tbody>
    <% @bingo_users_for_each_turn.keys.sort.each do |turn| %>
      <tr>
        <td><%= turn %></td>
        <td><%= @bingo_users_for_each_turn[turn].map{|user| user.email}.join(', ') %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<%= link_to 'ゲーム一覧へ', admin_games_path %>

<script type="text/javascript">
  $(function(){
    App.notifications = App.cable.subscriptions.create(
      {  
        channel: "NotificationsChannel", 
        game_id: <%= @game.id %>
      },
      {
        connected: function() {
          App.notifications.notify_lot();
        },
        notify_lot: function() {
          return this.perform('notify_lot', {game_id: <%= @game.id %>});
        }
      }
    );
  });
</script>
